<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8">
<title>FIDOO - Format Identification of Digital Objects Online</title>
<script type="text/javascript" src="lib/fidoo-setup.js"></script>
<script type="text/javascript" src="lib/fidoo-core.js"></script>
<style>
* {
	font-family: Helvetica;
	font-size: 16px;
	margin: 2px;
	}
div, p {
	font-size: 80%;
	display: block;
	}
#debug {
	font-family: Courier;
	}
.link {
	color: #0000ff;
	background-color: #ffffff;
	text-decoration: underline;
	cursor: pointer;
	}
.link:hover {
	color: #ffffff;
	background-color: #0000ff;
	text-decoration: underline;
	}
.clickLink {
	color: #ffffff;
	background-color: #0000ff;
	text-decoration: underline;
	cursor: pointer;
	}

</style>
<script type="text/javascript">
// javascript only, no jquery or other libs
var files = {};
window.onload = function() { 
	 document.getElementById("files").addEventListener("change", handleFileSelect);
	 }
function write(element, content) {
	document.getElementById(element).innerHTML = content;
	}
function appendChild(element, content) {
	document.getElementById(element).appendChild(content);
	}
function appendHTML(element, content) {
	document.getElementById(element).innerHTML += content;
	}

function handleFileSelect(evt) {
	files = document.getElementById("files").files;
// 	console.dir(files);
	document.getElementById("fileList").innerHTML = "";
	for(var i = 0, file; file = files[i]; i++) {
		var filename = escape(file.name);
		var link = document.createElement("span");
		link.setAttribute("class","link");
		link.setAttribute("onclick","showResult(this);");
		// filename needs to be escaped like:
		// escape->decodeURIComponent->unescape
		// because of special characters like "Ã¯"
		link.innerHTML = unescape(decodeURIComponent(escape(filename)));
		appendChild("fileList", link);
		appendHTML("fileList", " / ");
		}
	write("info", "click on a filename for info");
	}

function showResult(that) {
	var anchors = document.getElementsByTagName("span");
		for(var i = 0; i < anchors.length; i++) {
			anchors[i].className = "link";
			}
	that.className = "clickLink";
	var filename = escape(that.textContent);
	 // warning: Fidoo.processFileObjectBrowser is an async function
	 // and returns info from the browser
	 // the result is in Fidoo.identifyResults[filename]
	 // that is why we use helper function "waitForResult"
	 // which prints the result to debug if available
	 // else it keeps trying recursively
	var info = Fidoo.processFileObjectBrowser(files, filename);
	write("info", "<pre>" + JSON.stringify(info, null, "\t") + "</pre>");
	var result = waitForResult(filename);
	return true;
	}

function waitForResult(filename) { // recursive and dangerous
	if(Fidoo.identifyResults[filename] === undefined) {
		setTimeout(function() {
			waitForResult(filename);
			}, 0);
		}
	else {
		write("debug", "<pre>" + JSON.stringify(Fidoo.identifyResults[filename], null, "\t") + "</pre>");
		return true;
		}
	}

</script>
</head>
<body>
<h1>Fidoo - Format Identification of Digital Objects Online</h1>
<h2>Version 0.0.1</h2>
<hr />
Select one or more files: <input type="file" name="files[]" id="files" multiple />
<hr />
<h3>Files</h3>
<div id="fileList">none</div>
<hr />
<h3>Info</h3>
<div id="info">Browse one or more files and click on the name</div>
<hr />
<h3>Debug</div>
<div id="debug">debug</div>
<hr />
<h5>TechMaurice 2016</h5>
</body>
</html>
